<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n L√Ω ƒê∆°n H√†ng - Nam Fruit</title>
    <link rel="stylesheet" href="/Font/fontawesome-free-6.7.2-web/css/all.min.css">
    <link rel="stylesheet" href="/css/staff.css">
    <script src="/js/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="sidebar">
        <img src="/img/o_bg-remover-gen_2rbFSjxWiA0b8V11LXqgNGl4BsO.png" class="logo-admin" alt="Logo">
        
        <h2>NH√ÇN VI√äN B√ÅN H√ÄNG</h2>
        
        <a href="#" class="menu-item active">
            <i class="fas fa-clipboard-list"></i> Qu·∫£n l√Ω ƒê∆°n h√†ng
        </a>
        
        <hr style="border-color: rgba(255,255,255,0.2);">
        
        <a href="/dang-xuat" class="menu-item">
            <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
        </a>
    </div>

    <div class="content">
        <h1 style="color: #82b53f; margin-top: 0;">üì¶ DANH S√ÅCH ƒê∆†N H√ÄNG</h1>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>M√£ ƒêH</th>
                        <th>Kh√°ch h√†ng</th>
                        <th>Ng√†y ƒë·∫∑t</th>
                        <th>T·ªïng ti·ªÅn</th>
                        <th>Ghi ch√∫</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    <% if(orders && orders.length > 0) { %>
                        <% orders.forEach(od => { %>
                        <tr>
                            <td>#<%= od.ma_hoa_don %></td>
                            <td style="font-weight: bold;"><%= od.ho_ten %></td>
                            <td><%= new Date(od.ngay_dat_hang).toLocaleString() %></td>
                            <td style="color: red; font-weight: bold;"><%= od.tong_tien.toLocaleString() %>‚Ç´</td>
                            <td style="font-style: italic; color: #666;"><%= od.ghi_chu || 'Kh√¥ng c√≥' %></td>
                            <td>
                                <span class="status <%= od.trang_thai.toLowerCase() %>">
                                    <% 
                                        let tt = od.trang_thai;
                                        if(tt == 'Cho_xac_nhan') tt = 'Ch·ªù x√°c nh·∫≠n';
                                        if(tt == 'Da_xac_nhan') tt = 'ƒê√£ x√°c nh·∫≠n';
                                        if(tt == 'Da_thanh_toan') tt = 'ƒê√£ thanh to√°n';
                                    %>
                                    <%= tt %>
                                </span>
                            </td>
                            <td>
                                <button class="btn-action btn-view" onclick="xemChiTiet('<%= od.ma_hoa_don %>')" title="Xem chi ti·∫øt"><i class="fas fa-eye"></i></button>
                                
                                <% if(od.trang_thai == 'Cho_xac_nhan') { %>
                                    <button class="btn-action btn-confirm" onclick="capNhatTrangThai('<%= od.ma_hoa_don %>', 'xac_nhan')" title="X√°c nh·∫≠n ƒë∆°n"><i class="fas fa-check"></i></button>
                                    <button class="btn-action btn-cancel" onclick="capNhatTrangThai('<%= od.ma_hoa_don %>', 'huy')" title="H·ªßy ƒë∆°n"><i class="fas fa-times"></i></button>
                                <% } %>

                                <% if(od.trang_thai == 'Da_xac_nhan') { %>
                                    <button class="btn-action btn-pay" onclick="capNhatTrangThai('<%= od.ma_hoa_don %>', 'thanh_toan')" title="X√°c nh·∫≠n ƒë√£ thu ti·ªÅn"><i class="fas fa-money-bill-wave"></i> Thu ti·ªÅn</button>
                                <% } %>
                            </td>
                        </tr>
                        <% }) %>
                    <% } else { %>
                        <tr><td colspan="7" style="text-align: center;">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</td></tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="$('#detailModal').hide()">&times;</span>
            <h2 style="color: #82b53f;">Chi ti·∫øt ƒë∆°n h√†ng #<span id="modalOrderId"></span></h2>
            <table style="margin-top: 15px;">
                <thead><tr><th>·∫¢nh</th><th>S·∫£n ph·∫©m</th><th>Gi√° l√∫c mua</th><th>SL</th><th>Th√†nh ti·ªÅn</th></tr></thead>
                <tbody id="modalBody"></tbody>
            </table>
        </div>
    </div>

    <script src="/js/staff.js"></script>
</body>
</html>